# Psy-Agent

# What is Psy-Agent

The **Psy-Agent** is a  LLM-powered (large language model) autonomous **agent system** designed by the BUPT AI4AI team.  

Psy-Agent utilizes the capabilities of LLM agents to streamline and automate complex workflows, enhancing efficiency and productivity for  counseling.

# Agent -> Agent Flow -> Psy-Agent

Psy-Agent utilizes the capabilities of LLM agents to streamline and automate complex workflows, enhancing efficiency and productivity for counseling.

## What is an Agent?

An **agent** is a software assistant that can autonomously complete tasks. It can:
- Understand user commands or requests.
- Perform actions based on commands.
- Provide feedback or results.

For example, ChatGPT is an agent that can understand your questions, retrieve information, and give answers.


**Agent is the fundamental unit of Psy-Agent.** **LLM** (eg,. Copilot \ GPT-4) functions as the agentâ€™s brain, integrated with **memory**, **tools** and **planning** framework. An agent can be used to solve atomic task in a specific field (eg,. code generation, draw bar chart).

**For a complicated task, multiple agents consist an agent flow**, where data moves from upstream to downstream. A complicated task is decomposed into many atomic tasks and assigned to various agents in the flow. The agents in upstream and downstream share tools and memory.  The agent flow is a pipeline framework that solves a complex problem step by step.

The agent flow can be framed as a powerful general problem solver.

## Agent Overview

**Agent= LLM+Planning+Tools+Memory**

![A overview of a agent in Psy-Agent](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240711203830651.png)

 The agent in Psy-Agent integrated LLM with several key components:

- **Planning**
  - **Chain of Thought:**  (CoT; [Wei et al. 2022](https://arxiv.org/abs/2201.11903)) The LLM will generate step by step. The reasoning will be explicitly generated by LLM to guide following complex code generation.  Agent in Psy-Agent follow react ([Yao et al. 2023](https://arxiv.org/abs/2210.03629)) framework, which can follow the  ** **think - action-observation** ** pipeline.   ï¼ˆDoneï¼‰
  - **Task decomposition:** The agent breaks down large tasks into smaller, manageable subgoals, enabling efficient handling of complex tasks.  **ï¼ˆDone, Auto reasoning-TODO)**
  - **Reflection and refinement:** The agent can do self-criticism and self-reflection over ([Shinn &amp; Labash 2023](https://arxiv.org/abs/2303.11366)) past actions, learn from mistakes and refine them for future steps, thereby improving the quality of final results.  **ï¼ˆDoneï¼‰**
- **Memory**
  - **Short-term memory:** The code generation agent will be finetune in local PSY-Insight dataset. **ï¼ˆWe have Exported Psy-Insight for trainingï¼‰**
  - **Long-term memory:** The common tool will be packed and saved in local for retrieval-augmented-generation (RAG;[Lewis et el. (2021)](https://www.promptingguide.ai/techniques/rag) and Tool learning ([Paranjape et al., (2023)](https://arxiv.org/abs/2303.09014)).**ï¼ˆTODOï¼‰**
    Graph RAG (Retrieval-Augmented Generation) is a powerful method used to construct vector representations of data. It integrates retrieval-based techniques with generative models to enhance the quality and relevance of generated content.

    ### How Graph RAG Constructs Vectors
    Graph RAG constructs vectors by leveraging both the retrieval and generation processes. Here's a simplified explanation:
    1. **Data Retrieval**: The model retrieves relevant data from a predefined knowledge base or dataset.
    2. **Data Integration**: Retrieved data is integrated with the input context to form a comprehensive understanding.
    3. **Vector Generation**: The integrated data is used to generate high-quality vectors, representing the essential features and relationships within the data.
  
- **Tool use & Tool build**
  - **Tool- learning:**([Qin et el. (2023)](https://arxiv.org/pdf/2304.08354)) The agent learns to call external APIs for extra knowledge that is missing from the pretrained LLM , including local information (**User-Case history/Psy-Wiki)**, code execution capability (** Python**), access to opensource tools (**Echart / Pandas **) and more.**ï¼ˆDoneï¼‰**
  - ![image-20240719111727108](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240719111727108.png)
  - **Tool Users as Tool Makers**: [(Cai et el. (2023)](https://arxiv.org/abs/2305.17126) The agent learn how to use provided specific tool for task. For example, visual agent use Echart component to draw chart. **ï¼ˆDoneï¼‰** 
    - **Function call and Tool use** (OpenAPI Integration in Assistant) : 
      1. **Triggering Tools**: If a response requires a specific tool.
      2. **Implementing Tools**: Custom tools are implemented to perform specific tasks, such as database queries or running test cases.
      3. **Tool Response Handling**: Integrated back into the conversation context.

  
    - In the future, users will be allowed to make their own tools / function in real time (eg,. a tool for calculate mean value for pandas chart). Tool Maker Agent can save these tools for tool-learning and other agents can also retrieved these new tools for similar task in next time **ï¼ˆTODOï¼‰**

## Agent Flow Overview

**Chart Agent Flow= Code Agent -> PGPsy-Agent Agent -> Visual Agent**

**Explain Agent Flow = Code Agent -> PGPsy-Agent Agent -> Explain Agent**

---

![image-20240711231259532](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240711231259532.png)

In the current Psy-Agent, specific agent within an agent flow relies on our magic commands for activation (e.g., $run, $explain). In the future, Psy-Agent will be able to automatically generate agent flow with planning (task decomposition) ability .




# Technical Architecture of Psy-Agent

## Frontend: Streamlit

Streamlit was chosen for the frontend development of Psy-Agent due to its simplicity and powerful capabilities.

### Advantages
- **Ease of Use**: Streamlit allows for development with minimal code.
- **Integration with Python**: Integrates with our backend and data processing libraries.
- **Interactive Widgets**: Support for interactive widgets.
- **Open Source**: It has a supportive community and continuous updates.

### Disadvantages
- **Performance Limitations**: For very large-scale applications, face performance issues.
- **Limited Deployment Options**: Streamlit's deployment options are not extensive.


## Backend: Python on Azure Web App
The backend of Psy-Agent is developed using Python and hosted on Azure Web App.
### Advantages
- **Scalability**: Azure Web App offers scalable solutions to handle varying loads efficiently.
- **Integration with Azure Services**: Easy integration with Azure services such as databases, AI, and machine learning tools.
- **Security**: Security features and compliance certifications.
- **Developer Productivity**: Python is known for its simplicity, readability and extensive support.
### Disadvantages
- **Cost**
- **Complexity**: Azure services can be complex and require specialized knowledge.
- **Dependency Management**: Ensuring all Python dependencies work smoothly in the Azure environment can be challenging.

# TO-DO & Done

* [x] ðŸ”¥ June 4, 2024: Azure credential for GPT-4

* [x] ðŸ”¥ June 5, 2024: Scala generation explore

* [x] ðŸ”¥ June 10, psy prompt for case understanding

* [x] ðŸ”¥ June 11, 2024: example for simple question pipeline

* [x] ðŸ”¥ June 15, 2024: prompt engineering for 2 stage generation

* [x] ðŸ”¥ June 20, 2024: Repos created + homepage

* [x] ðŸ”¥ June 21, 2024: code excutor

* [x] ðŸ”¥June 29, 2024: Pandas dataframe renderer for chart interactionï¼ˆcsv, search,replace ï¼‰

* [x] ðŸ”¥July ,3 2024: Chart explainer for diagnose result.

* [x] ðŸ”¥July 3, 2024: Bar /Line/Pie echarts supported!

* [x] ðŸ”¥July 5, 2024: Code editor

* [x] ðŸ”¥July 10, 2024: Add about Page

* [x] ðŸ“š July 12, 2024: chat with therapist

  ![image-20240719111844896](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240719111844896.png)

* [x] ðŸ“šJuly 19, 2024: Chat with Tool User

* [ ] ðŸ“šToDo: Finetuning in Psy-Insight dataset for generalization (P0)

* [ ] ðŸ“šToDo: Visual agent flow webfront

* [ ] ðŸ“šToDo: Automatic agent flow

# Tutorial & Example

[TODO a video]


* **Explain the data**

```
$explain$ please explain chart in 100 words
```

![image-20240711232949701](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240711232949701.png)

* **Draw Echart for data visualization **

  ```bash
  # command
  $visual$ please draw a pie chart.
  ```

![image-20240711225820282](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240711225820282.png)

* **Use Tool**

```
$usetool$ Please generate daily check report on July 10th, 2024.
```



![image-20240730104704443](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240730104704443.png)

```
$usetool$ Please generate daily check report on July 10th, 2024.
```



![image-20240719111322732](https://ckqqqq-qiker-image-service.oss-cn-beijing.aliyuncs.com/typora-image/image-20240719111322732.png)

## Plan
- Finetuning in Psy-Insight dataset for generalization: 

  Natural Language Processing (NLP) Enhancements
- Long memory:

  Graph RAG building for comlex case and retrival
- Query optimize for mutiple query
- Tool build: Titan support
- Automated Data Cleaning and Preprocessing Pipelines
- Real-time Analytics and Dashboarding: 

    Speed optimize
- Cross-domain Transfer Learning

## Related Work

 Several proof of agent concepts demos, such as [AutoGPT](https://github.com/Significant-Gravitas/Auto-GPT), [Autogen]() and [BabyAGI](https://github.com/yoheinakajima/babyagi), serve as inspiring examples.

* [AutoGen | AutoGen (microsoft.github.io)](https://microsoft.github.io/autogen/) The  **AutoGPT** is an Open-Source Programming Framework for Agentic AI
* [yoheinakajima/babyagi (github.com)](https://github.com/yoheinakajima/babyagi) **The Baby API** uses OpenAI and vector databases such as Chroma or Weaviate to create, prioritize, and execute tasks.
* [Significant-Gravitas/AutoGPT: AutoGPT is the vision of accessible AI for everyone, to use and to build on. Our mission is to provide the tools, so that you can focus on what matters. (github.com)](https://github.com/Significant-Gravitas/AutoGPT)  **AutoGPT** is a generalist LLM based AI agent that can autonomously accomplish minor tasks.

## Reference

* https://www.promptingguide.ai/
* [Lil&#39;Log (lilianweng.github.io)](https://lilianweng.github.io/)
* [Retrieval Augmented Generation: Streamlining the creation of intelligent natural language processing models (meta.com)](https://ai.meta.com/blog/retrieval-augmented-generation-streamlining-the-creation-of-intelligent-natural-language-processing-models/)

# Issue

If you have any issues, please contact   ckqqqq@bupt.edu.cn.
